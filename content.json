{"meta":{"title":"方舟博客","subtitle":"这是一艘载满医学科研的方舟号！","description":"要人心之自由，胸襟开放；要有一个远见，超越未见","author":"方舟","url":"https://fangzhoufan.github.io","root":"/"},"pages":[{"title":"2024本科毕业相关图片","text":"","path":"Gallery/bachelorimg.html","date":"06-26","excerpt":""},{"title":"gallery","text":"本科毕业 2024本科毕业相关图片(2019-2024)","path":"Gallery/index.html","date":"06-26","excerpt":""},{"title":"方舟分类","text":"","path":"categories/index.html","date":"06-14","excerpt":""},{"title":"友情链接","text":"","path":"link/index.html","date":"06-14","excerpt":""},{"title":"方舟标签页","text":"","path":"tags/index.html","date":"06-14","excerpt":""}],"posts":[{"title":"How to use the Hexo codes","text":"Blogs 上述在本地文件夹blogs下打开git bash，后进行相关处理，部署是在github上 Video：Hexo部署使用 Website：博客资料 1.常见的hexo使用命令123456789101112131415161718192021##生成npx hexo g##上传npx hexo d##预览npx hexo serve##新建文章npx hexo n ‘myblog’#使用VPN时，调整Git代理设置git config --global http.proxygit config --global https.proxy#未使用VPN时，取消Git代理设置git config --global --unset http.proxygit config --global --unset https.proxy","path":"2024/06/26/my blog/","date":"06-26","excerpt":"","tags":[]},{"title":"MRZhou simplify the mendelian randomization analysis","text":"MRZhouThis R package is designed for the convenience of medical professionals, aiming to further simplify the analysis methods of Mendelian randomization (MR). It is integrated based on the TwosampleMR, MRpresso, and coloc packages. Therefore, whether it is the online data of the IEU GWAS database or local GWAS data (such as FinnGen database), this package can be conveniently executed. This package also includes: GSMR analysis, SMR analysis methods, etc. TWAS&#x2F;Fusion analysis function method is under development. When using this MRZhou package, it is recommended to first learn the basic syntax of TwosampleMR. InstallationYou can install the development version of MRZhou from GitHub with: 12# install.packages(&quot;devtools&quot;)devtools::install_github(&quot;fangzhoufan/MRZhou&quot;) ExampleThis is a basic example which shows you how to solve a common problem: 1.Exposure and OutcomeLet’s identify the instrumental variables (IVs) for BMI and extract the BMI-associated SNPs from the CAD (coronary artery disease) outcome GWAS data. 123library(MRZhou)exp &lt;- extract_instruments(outcomes = &quot;ieu-a-2&quot;)out &lt;- extract_outcome_data(exp$SNP,outcomes = &quot;ieu-a-7&quot;) The above two functions are based on the TwosampleMR package, and detailed information can be found in the tutorial. If you would like to use the FinnGen database, you can follow: exposure: Exposure: BMI Outcome: CAD 12345library(MRZhou)data(&quot;finngenR9&quot;)data(&quot;finngenR10&quot;)# exp&lt;-read_finngen_exposure(&#x27;BMI&#x27;,&#x27;finngen_R10_BMI_IRN.gz&#x27;, 290820, p_threshold = 5e-08)# out&lt;-read_finngen_outcome(exp, &#x27;CAD&#x27;, &#x27;finngen_R10_I9_IHD.gz&#x27;, 412181) 2. IVW analysis (main analysis method)12345dat &lt;- harmonise_data(exp, out)result &lt;- IVW_fix_random(dat)test &lt;- mr_test(dat)presso &lt;- MRpresso(dat)resall &lt;- combine_results(result, test, presso) The resall dataframe is all of the MR methods results (including: MRpresso), Heterogeneity statistics and Horizontal pleiotropy results 3.Plot123456## Not include MRpresso method resultsforest_plot &lt;- forest_plot(result)## Include MRpresso method resultsresult2 &lt;- combine_results(result, NULL, presso)forest_plot &lt;- forest_plot(result2) 4.Other Visualization Volcano plot 1volcano_plot &lt;- volcano_plot(result) Circle plot 1circle_plot &lt;- circle_plot(result)","path":"2024/06/15/MRZhou_README/","date":"06-15","excerpt":"","tags":[]},{"title":"SMR 分析","text":"SMR 教程官方文档：SMR | Yang Lab (westlake.edu.cn) 1.数据获取1.1eqtl数据qtl数据获取主要从GTEx数据库，可以得到各种组织的数据。GTEx数据库的速度很慢建议从SMR官网的数据库下载（华人做的）SMR | Yang Lab (westlake.edu.cn)里面有各种qtl的数据集，下得很快！ eqtl还有血液的数据，样本量很大eQTLGen - cis-eQTLs 直接下载besd二进制格式即可，后期数据可以用smr软件自提 1.2GWAS数据GWAS数据获取的方法很多可以直接去IEU OpenGWAS project (mrcieu.ac.uk)下载，也可以通过R包TwoSampleMR直接从网站上拽。available_outcomes()函数可以看到openGWAS里面所有的gwas数据 当然还有很多别的获取手段。也可以从finngen的GWAS获取 1.3参考基因组用R包下载Download 1000G — download_1000G • bigsnpr (privefl.github.io) 也可以直接链接：http://fileserve.mrcieu.ac.uk/ld/1kg.v3.tgz 也可以自行从官网下载 不难发现，所需数据全是公共数据，而且获取比较轻松。 2.SMR2.1软件下载SMR | Yang Lab (westlake.edu.cn)下载即可，Windows和Linux均可 1smr --bld mybld --gwas-summary mygwas.ma --beqtl-summary myeqtl --out mysmr --thread-num 10 smr输入有 --bld 指的是1000人参考基因组的目录， --gwas-summary输入的是GWAS数据， --beqtl-summary 输入的是eqtl数据， --query 5e-8 --gene ENSG00000113161 --out 输出文集名 --make-besd *mygwas.ma* 1234SNP A1 A2 freq b se p nrs1001 A G 0.8493 0.0024 0.0055 0.6653 129850rs1002 C G 0.03606 0.0034 0.0115 0.7659 129799rs1003 A C 0.5128 0.045 0.038 0.2319 129830 1234567891011121314151617181920212223242526272829303132333435exp&lt;-fread(&#x27;GCST004744-EFO_0000571-Build37.f.tsv.gz&#x27;,data.table = F,header=T)tail(exp)exp$n&lt;-66756##ebi常用格式LUAD&lt;-exp%&gt;% dplyr::filter(str_detect(variant_id, &quot;^rs&quot;))%&gt;% dplyr::rename( SNP=variant_id, A1=effect_allele, A2=other_allele, freq=effect_allele_frequency, b=beta, se=standard_error, p=p_value, N=n )%&gt;% dplyr::select(SNP, A1, A2, freq, b, se, p, N) %&gt;% dplyr::filter(!str_detect(SNP, &quot;,&quot;))##finngen常用格式LUAD&lt;-exp%&gt;% dplyr::filter(str_detect(rsids, &quot;^rs&quot;))%&gt;% dplyr::rename( SNP=rsids, A1=alt, A2=ref, freq=af_alt, b=beta, se=sebeta, p=pval, N=n )%&gt;% dplyr::select(SNP, A1, A2, freq, b, se, p, N) %&gt;% dplyr::filter(!str_detect(SNP, &quot;,&quot;))head(LUAD,804)write.table(LUAD,&#x27;LUAD.ma&#x27;, sep = &quot;\\t&quot;, row.names = FALSE, col.names = TRUE, quote = FALSE) SMR 具体eqtlgen转换要求 123456789101112131415161718#超算平台cd &quot;/public/home/fanfangzhou/apps/SMR/smr_linux&quot; ##这里获取的是含有eQTLGen的HMGCR这基因的besd格式的&quot;/public/home/fanfangzhou/apps/SMR/smr_linux&quot; --beqtl-summary &quot;/public/home/fanfangzhou/R/GTEx8/SMR/eQTLGen/cis-eQTLs-full_eQTLGen_AF_incl_nr_formatted_20191212.new.txt_besd-dense&quot; --query 1 --gene ENSG00000113161 --out &quot;/public/home/fanfangzhou/R/2024science/6. Drugs mendelian/rotator cuff syndrome/rotator cuff injury/SMR/&quot; --make-besd##这里获取了HMGCR的besd格式文件，就可以在这个区间进行SMR分析&quot;/public/home/fanfangzhou/apps/SMR/smr_linux&quot; --bfile &quot;/public/home/fanfangzhou/R/Rcodes/486metabolites/1kg.v3/EUR&quot; --gwas-summary SMR_rotatorcuffR9.ma --beqtl-summary HMGCR --out rotatorblood --thread-num 10 2.3运行smr命令很简单，找着官网的改一改就行 12##超算平台&quot;/public/home/fanfangzhou/apps/SMR/smr_linux&quot; --bfile &quot;/public/home/fanfangzhou/R/Rcodes/486metabolites/1kg.v3/EUR&quot; --gwas-summary LUAD.ma --beqtl-summary &quot;/public/home/fanfangzhou/R/GTEx8/SMR/Whole_Blood/Whole_Blood&quot; --out Lung_SMR_wholeblood --thread-num 10 --diff-freq-prop 0.92 –diff-freq-prop 参数是等位基因频率的设定阈值，如果小的话程序是跑不通的。因为我输入的eqtl和gwas数据没经过过滤，被筛掉的snp的比例非常大，所以需要把这个阈值设高点防止程序终止。 3.共定位细心的朋友会发现，刚才我们并没有下载eqtl的txt列表格式的文件，理论上和gwas一样，eqtl也应该有一个非常大数据量的列表文件，那么如何得到呢，依然是靠smr软件 这里可以用eqtlgen的也可以用V8的，***–make-besd加这个就是输出besd格式的（三种文件那种），或者不加就是默认*txt 1smr-1.3.1-win.exe --beqtl-summary Artery_Aorta --query 0.05 --out Aorta_eqtl smr可以从二进制的besd文件中导出txt格式的eqtl文件，得到这里是Aorta_eqtl.txt文件 4.SMR locus plotSMR | Yang Lab (westlake.edu.cn) SMR locus plotHere we provide an R script to plot SMR results as presented in Zhu et al. (2016 Nature Genetics). The data file for plot can be generated by the command below. The R script is avaliable at Download. # SMR command line to generate a data file for plot1smr --bfile mydata --gwas-summary mygwas.ma --beqtl-summary myeqtl --out myplot --plot --probe ILMN_123 --probe-wind 500 --gene-list glist-hg19 5.Multi-SNP-based SMR testBelow shows an option to combine the information from all the SNPs in a region that pass a p-value threshold (the default value is 5.0e-8 which can be modified by the flag –peqtl-smr) to conduct a multi-SNP-based SMR analysis (Wu et al. 2018 Nature Communications). The SNPs are pruned for LD using a weighted vertex coverage algorithm with a LD r2 threshold (the default value is 0.9 which can be modified by the flag –ld-pruning) and eQTL p-value as the weight. 1smr --bfile mydata --gwas-summary mygwas.ma --beqtl-summary myeqtl --out mymulti --smr-multi –smr-multi turns on set-based SMR test in the cis-region. 1smr --bfile mydata --gwas-summary mygwas.ma --beqtl-summary myeqtl --out mymulti --smr-multi --set-wind 500 –set-wind defines a window width (Kb) centred around the top associated cis-eQTL to select SNPs in the cis-region. The default value is -9 resulting in selecting SNPs in the whole cis-region if this option is not specified. 1smr --bfile mydata --gwas-summary mygwas.ma --beqtl-summary myeqtl --out mymulti --smr-multi --ld-multi-snp 0.1 –ld-multi-snp LD r-squared threshold used to prune SNPs (eQTLs) in the Multi-SNP based SMR test. The default value is 0.1. 最初提出的定义独立顺式-eQTL的阈值为r2&lt; 0.9。然而，该阈值可能包括具有高 LD 的 SNP（定义为 r 2≥ 0.1）。因此，我们采用了 r 2&lt; 0.1 作为定义独立 SNP 的阈值 参考文献：基于转录组全汇总数据的孟德尔随机化分析揭示了 38 个与严重 COVID-19 相关的新基因 - PMC (nih.gov) GTEx V8 基因注释GTEx Portal网址里面的：https://storage.googleapis.com/adult-gtex/bulk-gex/v8/rna-seq/GTEx_Analysis_2017-06-05_v8_RNASeQCv1.1.9_gene_reads.gct.gz 12345678GTEx&lt;-read.table(&quot;GTEx_Analysis_2017-06-05_v8_RNASeQCv1.1.9_gene_reads.gct&quot;, skip = 2, header = TRUE, sep = &quot;\\t&quot;) save(GTEx,file = &#x27;GTEx.Rdata&#x27;) GTEx[1:4,1:4] ##行是基因 列是样本 # Name Description GTEX.1117F.0226.SM.5GZZ7 GTEX.1117F.0426.SM.5EGHI # 1 ENSG00000223972.5 DDX11L1 0 0 # 2 ENSG00000227232.5 WASH7P 187 109 # 3 ENSG00000278267.1 MIR6859-1 0 0 # 4 ENSG00000243485.5 MIR1302-2HG 1 0 colnames(GTEx) 5.常用数据V8 release of the GTEx eQTL&#x2F;sQTL summary dataV8 release of the GTEx eQTL&#x2F;sQTL summary data (n &#x3D; 73 - 670; [GTEx Consortium 2020 Science](https://www.science.org/doi/10.1126/science.aaz1776?url_ver=Z39.88-2003&amp;rfr_id=ori:rid:crossref.org&amp;rfr_dat=cr_pub 0pubmed)) in SMR binary (BESD) format: GTEx_V8_cis_eqtl_summary(hg19) (48 GB) GTEx_V8_cis_eqtl_summary_lite (hg19) Lite version of the GTEx V8 eqtl data (only SNPs with P &lt; 1e-5 are included; 506MB) This is a set of cis-eQTL summary data across 49 human tissues from the GTEx project. Only SNPs within 1Mb of the transcription start site are available. The forth column of the *.epi file is the middle position of the probe sequence rather than the transcription start site. cis-eQTLsThis page contains the cis-eQTL results. The statistically significant cis-eQTLs and SMR-prioritised genes for several traits are browsable, the other files can be downloaded. Downloads Significant cis-eQTLs Full cis-eQTL summary statistics README Initial release Significant cis-eQTLs (deprecated) Initial release Full cis-eQTL summary statistics (deprecated) 6.SMR使用技巧6.1.批量使用49个组织的SMR首先在R里面创建我们需要的sh格式的文件，当然我们可以进行txt简单创建 12345678910111213141516171819original_string1 &lt;- &#x27;echo Whole_Blood&quot;/public/home/fanfangzhou/apps/SMR/smr_linux&quot; --bfile &quot;/public/home/fanfangzhou/R/Rcodes/486metabolites/1kg.v3/EUR&quot; --gwas-summary LUAD.ma --beqtl-summary &quot;/public/home/fanfangzhou/R/GTEx8/SMR/Whole_Blood/Whole_Blood&quot; --out Lung_SMR_Whole_Blood --thread-num 10 --diff-freq-prop 0.92&#x27;original_string2 &lt;- &#x27;echo Whole_Blood&quot;/public/home/fanfangzhou/apps/SMR/smr_linux&quot; --bfile &quot;/public/home/fanfangzhou/R/Rcodes/486metabolites/1kg.v3/EUR&quot; --gwas-summary LUAD.ma --beqtl-summary &quot;/public/home/fanfangzhou/R/GTEx8/SMR/Whole_Blood/Whole_Blood&quot; --out Lung_SMR_Whole_Blood_test --smr-multi --ld-multi-snp 0.1 &#x27;# 待替换的字符串replace_values &lt;- original_string1 # 替换值的向量# 用替换值逐个替换原始字符串中的&quot;Whole_Blood&quot;replaced_strings &lt;- sapply(replace_values, function(value) &#123; gsub(&quot;Whole_Blood&quot;, value, original_string1)&#125;)writeLines(replaced_strings, &quot;script.sh&quot;) 123456789command &lt;- &#x27;#!/bin/bashls# 输出 &quot;Hello, world!&quot; 消息echo &quot;Hello, world!&quot;&#x27;writeLines(command, &quot;script.sh&quot;) 然后我们在linux系统里面使用sh格式运行 12345#使用 chmod 命令将该文件设置为可执行权限：chmod +x my_script.sh#执行该脚本文件：./my_script.sh 6.2.SMR 执行mult1&quot;/public/home/fanfangzhou/apps/SMR/smr_linux&quot; --bfile &quot;/public/home/fanfangzhou/R/Rcodes/486metabolites/1kg.v3/EUR&quot; --gwas-summary ON.ma --beqtl-summary &quot;/public/home/fanfangzhou/R/GTEx8/SMR/eQTLGen/cis-eQTLs-full_eQTLGen_AF_incl_nr_formatted_20191212.new.txt_besd-dense&quot; --out osteonecrosis_blood --smr-multi --ld-multi-snp 0.1","path":"2024/06/14/10.SMR/","date":"06-14","excerpt":"","tags":[]},{"title":"LDSC 分析","text":"连锁不平衡分数回归 LD score regression -LDSCLDSC原理为什么要做 LD score regression 在GWAS研究中，多基因性（polygenicity，即若干较小的基因效应）和干扰因素引起的偏差（如隐性关联 cryptic relatedness，群体分层population stratification等）都会造成检验的统计量的分布偏高（inflated）。但我们并不能分辨偏高的统计量到底是来自多基因性还是干扰因素，所以通过LD score regression，我们可以通过研究检验统计量与连锁不平衡（linkage disequilibrium）之间的关系来定量分析每部分的影响。 LDscore的原理？ GWAS检验中，对一个SNP效应量的估计通常也会包含与该SNP成LD的其他SNP的效应，也就是说一个与其他SNP成高LD的SNP，通常也会有更高的卡方检验量。 接下来简单介绍如何进行LDscore regression。使用的软件为ldsc，可以从作者的github中拉取。ldsc为python脚本，clone了ldsc的库之后我们还需要利用anaconda配置环境，下载相关联的package。 ldsc：https://github.com/bulik/ldsc 1234git clone https://github.com/bulik/ldsc.gitcd ldscconda env create --file environment.yml ##一定要通过conda来配置相同环境 让他自己配置，他这个配置基于source activate ldsc 以上步骤完成后，可以输入以下命令来检测是否安装成功 12./ldsc.py -h./munge_sumstats.py -h 除此以外，还需要相应群体的LD score，好消息是作者提供了处理好的欧洲 European 与 东亚 East asian的基于1000 genome的LD score以供我们使用，可以通过以下链接下载： http://fileserve.mrcieu.ac.uk/ld/1kg.v3.tgz https://github.com/perslab/CELLECT/blob/master/data/ldsc/w_hm3.snplist 使用教程本教程改编自： https://github.com/bulik/ldsc/wiki/Heritability-and-Genetic-Correlation 主要介绍：1.the LD Score regression intercept for a schizophrenia GWAS 与 2.the SNP-heritability for schizophrenia 使用的数据来自 2013年发表的 PGC Cross-Disorder paper in the Lancet.，精神分裂症 sci 与 双相障碍 bip 1 准备步骤下载LD score 12wget https://data.broadinstitute.org/alkesgroup/LDSCORE/eur_w_ld_chr.tar.bz2tar -jxvf eur_w_ld_chr.tar.bz2 下载GWAS summary 统计量数据 12wget www.med.unc.edu/pgc/files/resultfiles/pgc.cross.bip.zipwget www.med.unc.edu/pgc/files/resultfiles/pgc.cross.scz.zip 下载后解压，head命令查看文件是否正确 12345678910111213head pgc.cross.BIP11.2013-05.txtsnpid hg18chr bp a1 a2 or se pval info ngt CEUafrs3131972 1 742584 A G 1.092 0.0817 0.2819 0.694 0 0.16055rs3131969 1 744045 A G 1.087 0.0781 0.2855 0.939 0 0.133028rs3131967 1 744197 T C 1.093 0.0835 0.2859 0.869 0 .head pgc.cross.SCZ17.2013-05.txtsnpid hg18chr bp a1 a2 or se pval info ngt CEUafrs3131972 1 742584 A G 1 0.0966 0.9991 0.702 0 0.16055rs3131969 1 744045 A G 1 0.0925 0.9974 0.938 0 0.133028rs3131967 1 744197 T C 1.001 0.0991 0.9928 0.866 0 . 2 第一步 数据清理 （munge_sumstats.py）原始数据并不是ldsc所需要的.sumstats 格式，所以我们需要先清理并提取需要的数据。利用ldsc附带的munge_sumstats.py可以将原始数据转换成.sumstats 格式。 The ldsc .sumstats format requires six pieces of information for each SNP: A unique identifier (e.g., the rs number) Allele 1 (effect allele) Allele 2 (non-effect allele) Sample size (which often varies from SNP to SNP) A P-value A signed summary statistic (beta, OR, log odds, Z-score, etc) 1234567891011121314wget https://data.broadinstitute.org/alkesgroup/LDSCORE/w_hm3.snplist.bz2bunzip2 w_hm3.snplist.bz2munge_sumstats.py \\--sumstats pgc.cross.SCZ17.2013-05.txt \\--N 17115 \\--out scz \\--merge-alleles w_hm3.snplistmunge_sumstats.py \\--sumstats pgc.cross.BIP11.2013-05.txt \\--N 11810 \\--out bip \\--merge-alleles w_hm3.snplist 注意：有时数据量较大时程序会卡死，无响应状态，可以尝试在选项中加上 –chunksize 500000 以解决此问题 输出的log文件 12345678Metadata:Mean chi^2 = 1.229Lambda GC = 1.201Max chi^2 = 32.411 Genome-wide significant SNPs (some may have been removed by filtering). Conversion finished at Mon Apr 4 13:21:29 2016Total time elapsed: 16.07s 3 第二步 LD score regression利用清理好的数据，我们可以开始进行LD score regression，使用的是主程序ldsc.py 12345ldsc.py \\--h2 scz.sumstats.gz \\--ref-ld-chr eur_w_ld_chr/ \\--w-ld-chr eur_w_ld_chr/ \\--out scz_h2 --h2 ：计算遗传力，参数为上一步处理好的数据文件名 --ref-ld-chr ：使用的按染色体号分类的LD score文件名，参数为LD score文件所在文件夹的路径。默认情况下ldsc会在文件名末尾添加染色体号，例如 --ref-ld-chr eur_w_ld_chr/ 的意思就是使用 eur_w_ld_chr/1.l2.ldscore ... eur_w_ld_chr/22.l2.ldscore 这些文件。如果你的染色体号在其他位置，也可以使用@来告诉LDSC，例如 --ref-ld-chr ld/chr@ 。当然也可以用 --ref-ld 来指定一个整体的LD score文件。 --w-ld-chr：指定ldsc回归权重所用的LDscore文件，理论上对于SNPj的LD分数，应当包含这个SNP与其他所有SNP的R2之和，但实际操作中，LD score回归对于计算权重的SNP的选择并不敏感，所以一般情况下我们可以使用与 --ref-ld 与相同的文件。. --out ： 输出文件的路径与前缀 ldsc输出的log文件结尾就是我们所要的结果， 12345Total Observed scale h2: 0.5907 (0.0484)Lambda GC: 1.2038Mean Chi^2: 1.2336Intercept: 1.0014 (0.0113)Ratio: 0.0059 (0.0482) 结果解读： Total Observed scale h2： 总的观测尺度的遗传力 （详见易感性尺度遗传力与观测尺度遗传力 Liability scale heritability &amp; observed scale heritability） Lambda GC 与 Mean chi^2： 用于评估群体分层与隐性关联的影响 Ratio： 定义为attenuation ratio &#x3D; (LDSC intercept – 1) &#x2F; (mean χ2 – 1)， 衰减比：用来估计混淆因素与遗传效应的相对平衡","path":"2024/06/14/4.LDSC software/","date":"06-14","excerpt":"","tags":[]},{"title":"TWAS 分析","text":"TWAS FUSIONTWAS &#x2F; FUSION (gusevlab.org) Installation Download and unpack the FUSION software package from github: 123wget https://github.com/gusevlab/fusion_twas/archive/master.zipunzip master.zipcd fusion_twas-master Download and unpack the (1000 Genomes) LD reference data: 12wget https://data.broadinstitute.org/alkesgroup/FUSION/LDREF.tar.bz2tar xjvf LDREF.tar.bz2 Download and unpack the plink2R library (by Gad Abraham): 12wget https://github.com/gabraham/plink2R/archive/master.zipunzip master.zip Launch R and install required libraries: 12install.packages(c(&#x27;optparse&#x27;,&#x27;RColorBrewer&#x27;))install.packages(&#x27;plink2R-master/plink2R/&#x27;,repos=NULL) Typical analysis and output——Examples PGC精神分裂症的gwas summary数据对GTEx全血数据进行TWAS First, download and prepare the GWAS and GTEx whole blood data: 12345wget https://data.broadinstitute.org/alkesgroup/FUSION/SUM/PGC2.SCZ.sumstatsmkdir WEIGHTScd WEIGHTSwget https://data.broadinstitute.org/alkesgroup/FUSION/WGT/GTEx.Whole_Blood.tar.bz2tar xjf GTEx.Whole_Blood.tar.bz2 可以用**LDSC munge_stats.py**把gwas的格式转为我们需要的。 gwas结果全部输入进去，不要卡阈值。 Finally, we run FUSION.test.R using this data on chromosome 22: 1234567Rscript FUSION.assoc_test.R \\--sumstats PGC2.SCZ.sumstats \\--weights ./WEIGHTS/GTEx.Whole_Blood.pos \\--weights_dir ./WEIGHTS/ \\--ref_ld_chr ./LDREF/1000G.EUR. \\--chr 22 \\--out PGC2.SCZ.22.dat 实战——使用FinnGen数据集进行TWAS分析123456789##1.数据GWAS 下载链接wget https://storage.googleapis.com/finngen-public-data-r10/summary_stats/finngen_R10_H7_GLAUCCLOSEPRIM.gz##2.数据处理——转换为可以识别的GWAS类型zcat finngen_R10_H7_GLAUCCLOSEPRIM.gz \\ # 解压缩名为 finngen_R10_H7_GLAUCCLOSEPRIM.gz 的文件| awk &#x27;&#123;print $5&quot;\\t&quot;$3&quot;\\t&quot;$4&quot;\\t&quot;$11&quot;\\t&quot;$9&quot;\\t&quot;$10&quot;\\t&quot;$7&quot;&#125;&#x27; \\ # 使用 awk 提取感兴趣的列并按指定格式输出| grep &#x27;rs&#x27; \\ # 过滤包含 &#x27;rs&#x27; 的行| grep -v &#x27;,&#x27; \\ # 过滤掉含有逗号的行&gt; finngen_R10_H7_GLAUCCLOSEPRIM.gwas # 将结果保存到 finngen_R10_H7_GLAUCCLOSEPRIM.gwas 文件中 下方我们使用ldsc相关软件时候，我们需要进入anaconda的命令行 ，就是安装了相关环境的python中，python2.7，然后munge_sumstats.py执行下列代码 w_hm3.snplist文件从：https://github.com/perslab/CELLECT/blob/master/data/ldsc/w_hm3.snplist 1234567891011121314151617###2.TWAS 分析##处理成TWAS输入格式文件#清洗数据 munge_sumstats.py \\--sumstats finngen_R10_H7_GLAUCCLOSEPRIM.gwas \\--signed-sumstats beta \\--snp rsids \\--a1 alt \\--a2 ref \\--p pval \\--N 392582 \\--merge-alleles w_hm3.snplist \\--out finngen_R10_H7_GLAUCCLOSEPRIM--chunksize 500000##超算平台代码python &quot;/public/home/fanfangzhou/R/TWAS/ldsc/munge_sumstats.py&quot; --sumstats finngen_R10_H7_GLAUCCLOSEPRIM.gwas --merge-alleles --N 392582 --snp rsids --a1 alt --a2 ref --p pval --out finngen_R10_H7_GLAUCCLOSEPRIM --chunksize 500000 这里的N指的是研究的样本数量；finngen_R10_H7_GLAUCCLOSEPRIM.gwas是输出的文件名；w_hm3.snplist是被纳入分析的SNP，包含三列：包含rs编号、位置、A1（效应等位基因）、A2（无效等位基因）# 这一步可有可无如果想把所有的SNP位点纳入分析，那么采用这个命令： munge_sumstats.py --sumstats summary.txt --N 17115 --out s 123456789101112131415##R环境conda activate twasR##twas 分析for i in $(seq 1 22); do Rscript &quot;/public/home/fanfangzhou/R/TWAS/fusion_twas_master/FUSION.assoc_test.R&quot; --sumstats finngen_R10_H7_GLAUCCLOSEPRIM.sumstats.gz --weights &quot;/public/home/fanfangzhou/R/TWAS/GTExV8/GTExv8.EUR.Whole_Blood.pos&quot; --weights_dir &quot;/public/home/fanfangzhou/R/TWAS/GTExV8/&quot; --ref_ld_chr &quot;/public/home/fanfangzhou/R/TWAS/fusion_twas_master/LDREF/1000G.EUR.&quot; --chr $i --out qgy_blood_$i.twas; donefor i in $(seq 1 22); do Rscript &quot;/public/home/fanfangzhou/R/TWAS/fusion_twas-master/FUSION.assoc_test.R&quot; \\ --sumstats finngen_R10_H7_GLAUCCLOSEPRIM.sumstats.gz \\ --weights &quot;/public/home/fanfangzhou/R/TWAS/GTExV8/GTExv8.EUR.Whole_Blood.pos&quot; \\ --weights_dir &quot;/public/home/fanfangzhou/R/TWAS/GTExV8/&quot; \\ --ref_ld_chr &quot;/public/home/fanfangzhou/R/TWAS/fusion_twas-master/LDREF/1000G.EUR.&quot; \\ --chr $i \\ --out qgy_blood_$i.twas done 上述使用twas分析需要载入R 所以我们需要在anaconda切换到R所在的环境，并且也要安装需要的R包 weight就是参考使用的，这里用的GTExV8里面的 实战2——LUAD在之前一定要配置好相关文件 123456789101112131415ssh admin2screen -lsscreen -r +地址 ##进入screen操作页面cd &quot;/public/home/fanfangzhou/R/2024science/10.LUAD/1.SMR/&quot;source activate /public/home/fanfangzhou/anaconda/anaconda3/envs/ldsc ##这里就是之前LDSC配置的python2.7环境#LUAD.ma的数据包括：SNP A1 A2 freq b se p n 这些数据，是按照标准的SMR需要的gwas格式整理的python &quot;/public/home/fanfangzhou/R/TWAS/ldsc/munge_sumstats.py&quot; --sumstats LUAD.ma --N 66756 --out LUAD --chunksize 500000conda activate /public/home/fanfangzhou/anaconda/anaconda3/envs/twasR##twas 分析：whole bloodfor i in $(seq 1 22); do Rscript &quot;/public/home/fanfangzhou/R/TWAS/fusion_twas_master/FUSION.assoc_test.R&quot; --sumstats LUAD.sumstats.gz --weights &quot;/public/home/fanfangzhou/R/TWAS/GTExV8/GTExV8.EUR/GTExv8.EUR.Whole_Blood.pos&quot; --weights_dir &quot;/public/home/fanfangzhou/R/TWAS/GTExV8/GTExV8.EUR/&quot; --ref_ld_chr &quot;/public/home/fanfangzhou/R/TWAS/fusion_twas_master/LDREF/1000G.EUR.&quot; --chr $i --out TWAS_Whole_Blood_$i.twas; done##twas 分析：lungfor i in $(seq 1 22); do Rscript &quot;/public/home/fanfangzhou/R/TWAS/fusion_twas_master/FUSION.assoc_test.R&quot; --sumstats LUAD.sumstats.gz --weights &quot;/public/home/fanfangzhou/R/TWAS/GTExV8/GTExV8.EUR/GTExv8.EUR.Lung.pos&quot; --weights_dir &quot;/public/home/fanfangzhou/R/TWAS/GTExV8/GTExV8.EUR/&quot; --ref_ld_chr &quot;/public/home/fanfangzhou/R/TWAS/fusion_twas_master/LDREF/1000G.EUR.&quot; --chr $i --out LUAD_lung_$i.twas; done TWAS 相关数据库 Home - TWAS Atlas - CNCB-NGDC TWAS 可使用的参数模型GTEx v8 multi-tissue expressionEach archive contains two sets of pos files, one for genes with significant heritability and one for all genes (labeled no_filter). Using genes that achieved significant heritability is recommended for typical analyses. Using weights from “All Samples” will also typically increase sensitivity, unless analyzing highly European-specific regions. A detailed comparison of models by population and GTEx version is provided here. Positions in the pos files are taken from GTEx annotations. Weights were kindly estimated and provided by Junghyun Jung in the Mancuso lab. Tissue All Samples link EUR Samples link Adipose - Subcutaneous 581 download 479 download Adipose - Visceral (Omentum) 469 download 393 download Adrenal Gland 233 download 194 download Artery - Aorta 387 download 329 download Artery - Coronary 213 download 175 download Artery - Tibial 584 download 476 download Brain - Amygdala 129 download 119 download Brain - Anterior cingulate cortex (BA24) 147 download 135 download Brain - Caudate (basal ganglia) 194 download 172 download Brain - Cerebellar Hemisphere 175 download 157 download Brain - Cerebellum 209 download 188 download Brain - Cortex 205 download 183 download Brain - Frontal Cortex (BA9) 175 download 157 download Brain - Hippocampus 165 download 150 download Brain - Hypothalamus 170 download 156 download Brain - Nucleus accumbens (basal ganglia) 202 download 181 download Brain - Putamen (basal ganglia) 170 download 153 download Brain - Spinal cord (cervical c-1) 126 download 115 download Brain - Substantia nigra 114 download 100 download Breast - Mammary Tissue 396 download 329 download Skin - Transformed fibroblasts 483 download 403 download Blood - EBV-transformed lymphocytes 147 download 113 download Colon - Sigmoid 318 download 266 download Colon - Transverse 368 download 294 download Esophagus - Gastroesophageal Junction 330 download 275 download Esophagus - Mucosa 497 download 411 download Esophagus - Muscularis 465 download 385 download Heart - Atrial Appendage 372 download 316 download Heart - Left Ventricle 386 download 327 download Kidney - Cortex 73 download 65 download Liver 208 download 178 download Lung 515 download 436 download Minor Salivary Gland 144 download 114 download Muscle - Skeletal 706 download 588 download Nerve - Tibial 532 download 438 download Ovary 167 download 138 download Pancreas 305 download 243 download Pituitary 237 download 219 download Prostate 221 download 181 download Skin - Not Sun Exposed (Suprapubic) 517 download 430 download Skin - Sun Exposed (Lower leg) 605 download 508 download Small Intestine - Terminal Ileum 174 download 141 download Spleen 227 download 179 download Stomach 324 download 260 download Testis 322 download 272 download Thyroid 574 download 482 download Uterus 129 download 107 download Vagina 141 download 120 download Whole Blood 670 download 558 download For reproducibility, legacy models from GTEx v7 are available for significant genes and all genes. Legacy models from GTEx v6 are also available for significant genes. See here for a comparison of GTEx v6 and v7 model performance.","path":"2024/06/14/2.TWAS & FUSION/","date":"06-14","excerpt":"","tags":[]}],"categories":[],"tags":[]}